<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Custom opening method  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset="utf-8">
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>


    <a title="Custom opening method  Reference"></a>

    <header class="header">
      <p class="header-col header-col--primary">
        <a class="header-link" href="index.html">
          SeosMobileKeysSDK Docs
        </a>
        
      </p>
    
      <p class="header-col--secondary">
        <form role="search" action="search.json">
          <input type="text" placeholder="Search documentation" data-typeahead>
        </form>
      </p>
    
    
    </header>

    <p class="breadcrumbs">
      <a class="breadcrumb" href="index.html">SeosMobileKeysSDK Reference</a>
      <img class="carat" src="img/carat.png" />
      Custom opening method  Reference
    </p>

    <div class="content-wrapper">
      <nav class="navigation">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Getting started.html">Getting started</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="getting-started-with-the-sdk.html">Getting started with the SDK</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="installation-without-cocoapods.html">Installation without CocoaPods</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="logging.html">Logging</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Mobile Keys.html">Mobile Keys</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/MobileKeysManager.html">MobileKeysManager</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/MobileKeysManagerDelegate.html">MobileKeysManagerDelegate</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/MobileKeysEndpointInfo.html">MobileKeysEndpointInfo</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/MobileKeysKey.html">MobileKeysKey</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/MobileKeysLastAuthenticationInfo.html">MobileKeysLastAuthenticationInfo</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Mobile Keys.html#/c:@MobileKeysErrorDomain">MobileKeysErrorDomain</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Mobile Keys.html#/c:@MobileKeysHttpErrorDomain">MobileKeysHttpErrorDomain</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Mobile Keys.html#/c:@MobileKeysOptionApplicationId">MobileKeysOptionApplicationId</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Mobile Keys.html#/c:@MobileKeysOptionVersion">MobileKeysOptionVersion</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/EnvironmentType.html">EnvironmentType</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/MobileKeysInfoType.html">MobileKeysInfoType</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/MobileKeysErrorCode.html">MobileKeysErrorCode</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Mobile Keys.html#/c:@MobileKeysPreconditionFailedException">MobileKeysPreconditionFailedException</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Mobile Keys.html#/c:@F@MobileKeysPreconditionCheckTriggered">MobileKeysPreconditionCheckTriggered</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Bluetooth.html">Bluetooth</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/MobileKeysOpeningResult.html">MobileKeysOpeningResult</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/MobileKeysTimeoutConfiguration.html">MobileKeysTimeoutConfiguration</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/MobileKeysOpeningStatusType.html">MobileKeysOpeningStatusType</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/MobileKeysOpeningType.html">MobileKeysOpeningType</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/MobileKeysReader.html">MobileKeysReader</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/MobileKeysScanMode.html">MobileKeysScanMode</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/MobileKeysReaderProtocolVersion.html">MobileKeysReaderProtocolVersion</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Seos Access API.html">Seos Access API</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/MobileKeysSeosSession.html">MobileKeysSeosSession</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/MobileKeysSeosTag.html">MobileKeysSeosTag</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/MobileKeysApduCommand.html">MobileKeysApduCommand</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/MobileKeysApduConnectionProtocol.html">MobileKeysApduConnectionProtocol</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/MobileKeysApduResponse.html">MobileKeysApduResponse</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/MobileKeysAuthenticationKeySet.html">MobileKeysAuthenticationKeySet</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/MobileKeysMasterAuthenticationKeySet.html">MobileKeysMasterAuthenticationKeySet</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/MobileKeysGetDataApduCommand.html">MobileKeysGetDataApduCommand</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/MobileKeysPrivacyKeySet.html">MobileKeysPrivacyKeySet</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/MobileKeysPutDataApduCommand.html">MobileKeysPutDataApduCommand</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/MobileKeysSeosProvider.html">MobileKeysSeosProvider</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/MobileKeysSessionParameters.html">MobileKeysSessionParameters</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/MobileKeysSymmetricKeyPair.html">MobileKeysSymmetricKeyPair</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/MobileKeysSelectionResult.html">MobileKeysSelectionResult</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/MobileKeysKeyNumber.html">MobileKeysKeyNumber</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/MobileKeysHashAlgorithm.html">MobileKeysHashAlgorithm</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/MobileKeysSelectionType.html">MobileKeysSelectionType</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/MobileKeysSeosSessionType.html">MobileKeysSeosSessionType</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/MobileKeysEncryptionAlgorithm.html">MobileKeysEncryptionAlgorithm</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/SeosStatusWord.html">SeosStatusWord</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Seos Access API - sample code.html">Seos Access API - sample code</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="credential-for-test.html">Credential for test</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="read--write-tags-on-adf.html">Read &amp; write tags on ADF</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="read-adf-metadata.html">Read ADF metadata</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="master-authentication-keyset.html">Master authentication keyset</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="remote-session.html">Remote session</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="ake-session-setup.html">AKE Session Setup</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Advanced use cases.html">Advanced use cases</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/MobileKeysMotionRecognizer.html">MobileKeysMotionRecognizer</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/MobileKeysMotionRecognizerDelegate.html">MobileKeysMotionRecognizerDelegate</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/MobileKeysManagerExtendedDelegate.html">MobileKeysManagerExtendedDelegate</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Advanced use cases - sample code.html">Advanced use cases - sample code</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="custom-opening-method.html">Custom opening method</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Other Constants.html">Other Constants</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Other Constants.html#/c:@MobileKeysOptionBeaconUUID">MobileKeysOptionBeaconUUID</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Other Enums.html">Other Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/MobileKeysSessionClientIdentifier.html">MobileKeysSessionClientIdentifier</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">

        <section class="section">
          <div class="section-content">
            
            <h1 id='custom-opening-method' class='heading'>Custom opening method</h1>

<p>Implementing the delegate callback <code><a href="Protocols/MobileKeysManagerExtendedDelegate.html#/c:objc(pl)MobileKeysManagerExtendedDelegate(im)mobileKeysShouldInteractWithScannedReader:">-[MobileKeysManagerExtendedDelegate mobileKeysShouldInteractWithScannedReader:]</a></code> will
result in that you will receive a callback for each advertisement ping of the readers in the current vicinity. Using this delegate
callback it is possible to implement custom opening modes that are based on the readers advertisements and their RSSI
values.</p>

<p>You should only use this trigger if none of the current opening modes supported by the SDK fits your use case.</p>

<p>Also note that the combination of <code><a href="Classes/MobileKeysManager.html#/c:objc(cs)MobileKeysManager(im)closestReaderWithinRangeOfOpeningType:">-[MobileKeysManager closestReaderWithinRangeOfOpeningType:]</a></code> and
 <code><a href="Classes/MobileKeysManager.html#/c:objc(cs)MobileKeysManager(im)connectToReader:openingType:error:">-[MobileKeysManager connectToReader:openingType:error:]</a></code> would probably suffice for this particular use case. This
is only a implementation to display the mechanics.</p>

<p>ButtonPressOpeningTrigger.h:</p>
<pre class="highlight objective_c"><code><span class="cp">#import &lt;Foundation/Foundation.h&gt;
#import &lt;SeosMobileKeysSDK/SeosMobileKeysSDK.h&gt;
</span>
<span class="k">@protocol</span> <span class="nc">ButtonPressOpeningTriggerDelegate</span> <span class="o">&lt;</span><span class="n">NSObject</span><span class="o">&gt;</span>
<span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">didTimeoutWhileWaitingForReader</span><span class="p">;</span>
<span class="k">@end</span>

<span class="k">@interface</span> <span class="nc">ButtonPressOpeningTrigger</span> <span class="p">:</span> <span class="nc">NSObject</span><span class="o">&lt;</span><span class="n">MobileKeysManagerExtendedDelegate</span><span class="o">&gt;</span>

<span class="k">@property</span><span class="p">(</span><span class="n">weak</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">id</span> <span class="o">&lt;</span><span class="n">ButtonPressOpeningTriggerDelegate</span><span class="o">&gt;</span> <span class="n">delegate</span><span class="p">;</span>

<span class="k">-</span> <span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="nf">initWitManager</span><span class="p">:(</span><span class="n">MobileKeysManager</span> <span class="o">*</span><span class="p">)</span><span class="nv">manager</span><span class="p">;</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">userDidPressUnlockButton</span><span class="p">;</span>

<span class="cp">#pragma MobileKeysManager delegation
</span>
<span class="k">-</span> <span class="p">(</span><span class="n">BOOL</span><span class="p">)</span><span class="nf">mobileKeysShouldInteractWithScannedReader</span><span class="p">:(</span><span class="n">MobileKeysReader</span> <span class="o">*</span><span class="p">)</span><span class="nv">mobileKeysReader</span><span class="p">;</span>

<span class="k">@end</span>
</code></pre>

<p>ButtonPressOpeningTrigger.m:</p>
<pre class="highlight objective_c"><code><span class="cp">#import "ButtonPressOpeningTrigger.h"
</span>
<span class="k">static</span> <span class="k">const</span> <span class="n">NSTimeInterval</span> <span class="n">kTimeoutThreshold</span> <span class="o">=</span> <span class="mi">15</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span> <span class="cm">/* 15 seconds */</span>

<span class="k">@implementation</span> <span class="nc">ButtonPressOpeningTrigger</span> <span class="p">{</span>
    <span class="n">MobileKeysManager</span> <span class="o">*</span><span class="n">_manager</span><span class="p">;</span>
    <span class="n">NSTimeInterval</span> <span class="n">_userPressedButtonAt</span><span class="p">;</span>
    <span class="n">BOOL</span> <span class="n">_userPressedButton</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">-</span> <span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="n">initWitManager</span><span class="o">:</span><span class="p">(</span><span class="n">MobileKeysManager</span> <span class="o">*</span><span class="p">)</span><span class="n">manager</span> <span class="p">{</span>
    <span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="nf">init</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_manager</span> <span class="o">=</span> <span class="n">manager</span><span class="p">;</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">resetUserPressedButton</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">userDidPressUnlockButton</span> <span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"User did press unlock button"</span><span class="p">);</span>
    <span class="n">_userPressedButton</span> <span class="o">=</span> <span class="nb">YES</span><span class="p">;</span>
    <span class="n">_userPressedButtonAt</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">secondsSince1970</span><span class="p">];</span>
<span class="p">}</span>

<span class="o">-</span> <span class="p">(</span><span class="n">BOOL</span><span class="p">)</span><span class="n">mobileKeysShouldInteractWithScannedReader</span><span class="o">:</span><span class="p">(</span><span class="n">MobileKeysReader</span> <span class="o">*</span><span class="p">)</span><span class="n">mobileKeysReader</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">_userPressedButton</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">([</span><span class="n">self</span> <span class="nf">isInOpeningWindow</span><span class="p">])</span> <span class="p">{</span>
            <span class="n">NSLog</span><span class="p">(</span><span class="s">@"Opening from UI"</span><span class="p">);</span>
            <span class="p">[</span><span class="n">self</span> <span class="nf">resetUserPressedButton</span><span class="p">];</span>
            <span class="cm">/* Please note that this will open the first reader that is inside of the 
            Twist and Go range. This is not necessarily the closest reader. */</span>
            <span class="k">if</span><span class="p">([</span><span class="n">mobileKeysReader</span> <span class="nf">isInRangeFor</span><span class="p">:</span><span class="n">MobileKeysOpeningTypeMotion</span><span class="p">]</span> <span class="p">{</span>
               <span class="k">return</span> <span class="nb">YES</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="p">[</span><span class="n">self</span> <span class="nf">resetUserPressedButton</span><span class="p">];</span>
            <span class="n">NSLog</span><span class="p">(</span><span class="s">@"Reader became available but we timed out while waiting for it"</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">([</span><span class="n">_delegate</span> <span class="nf">respondsToSelector</span><span class="p">:</span><span class="k">@selector</span><span class="p">(</span><span class="n">didTimeoutWhileWaitingForReader</span><span class="p">)])</span> <span class="p">{</span>
                <span class="p">[</span><span class="n">self</span><span class="o">-&gt;</span><span class="n">_delegate</span> <span class="nf">didTimeoutWhileWaitingForReader</span><span class="p">];</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">NO</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">-</span> <span class="p">(</span><span class="n">BOOL</span><span class="p">)</span><span class="n">isInOpeningWindow</span> <span class="p">{</span>
    <span class="c1">//Duration between now and when the button press
</span>    <span class="c1">//should be smaller than the timeout threshold
</span>    <span class="k">return</span> <span class="p">([</span><span class="n">self</span> <span class="nf">secondsSince1970</span><span class="p">]</span> <span class="o">-</span> <span class="n">_userPressedButtonAt</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">kTimeoutThreshold</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">resetUserPressedButton</span> <span class="p">{</span>
    <span class="n">_userPressedButton</span> <span class="o">=</span> <span class="nb">NO</span><span class="p">;</span>
    <span class="n">_userPressedButtonAt</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">-</span> <span class="p">(</span><span class="n">NSTimeInterval</span><span class="p">)</span><span class="n">secondsSince1970</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[[</span><span class="n">NSDate</span> <span class="nf">date</span><span class="p">]</span> <span class="nf">timeIntervalSince1970</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">@end</span>
</code></pre>

          </div>
        </section>


      </article>
    </div>
    <section class="footer">
      <p>© 2017 ASSA ABLOY Mobile Services. All rights reserved.</p>
      <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.8.4</a>, a <a class="link" href="http://realm.io" target="_blank" rel="external">Realm</a> project.</p>
    </section>
  </body>
</div>
</html>
